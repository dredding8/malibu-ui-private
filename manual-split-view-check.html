<!DOCTYPE html>
<html>
<head>
    <title>Manual Split View Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>Split View Activation Check</h1>
    
    <div id="instructions" class="status info">
        <h3>Instructions:</h3>
        <ol>
            <li>Make sure your development server is running (npm start)</li>
            <li>Open the browser console (F12) to see detailed logs</li>
            <li>Click the buttons below to test different aspects</li>
        </ol>
    </div>

    <h2>Tests</h2>
    
    <button onclick="checkFeatureFlags()">1. Check Feature Flags</button>
    <button onclick="checkComponentRendering()">2. Check Component Rendering</button>
    <button onclick="testSplitViewInteraction()">3. Test Split View Interaction</button>
    <button onclick="checkForModals()">4. Check for Modal Elements</button>
    
    <h2>Results</h2>
    <div id="results"></div>

    <script>
        const baseUrl = 'http://localhost:3000';
        const resultsDiv = document.getElementById('results');

        function addResult(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<h4>${title}</h4><pre>${JSON.stringify(content, null, 2)}</pre>`;
            resultsDiv.appendChild(div);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function checkFeatureFlags() {
            clearResults();
            
            // Check localStorage
            const localFlags = localStorage.getItem('featureFlags');
            addResult('LocalStorage Feature Flags', localFlags ? JSON.parse(localFlags) : 'No flags in localStorage');

            // Check default expected flags
            const expectedFlags = {
                enableSplitView: true,
                useRefactoredComponents: false
            };
            
            addResult('Expected Flags for Split View', expectedFlags);

            // Provide manual override script
            const overrideScript = `
// Run this in the browser console to force split view:
const flags = JSON.parse(localStorage.getItem('featureFlags') || '{}');
flags.enableSplitView = true;
flags.useRefactoredComponents = false;
localStorage.setItem('featureFlags', JSON.stringify(flags));
location.reload();
`;
            addResult('Manual Override Script', overrideScript, 'success');
        }

        async function checkComponentRendering() {
            clearResults();
            
            const iframe = document.createElement('iframe');
            iframe.src = `${baseUrl}/collection-opportunities`;
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = '1px solid #ccc';
            
            iframe.onload = () => {
                try {
                    const iframeDoc = iframe.contentDocument;
                    
                    const components = {
                        splitView: iframeDoc.querySelector('.collection-opportunities-split-view'),
                        refactored: iframeDoc.querySelector('.collection-opportunities-refactored'),
                        enhanced: iframeDoc.querySelector('.collection-opportunities-enhanced'),
                        legacy: iframeDoc.querySelector('.collection-opportunities'),
                        mainContent: iframeDoc.querySelector('.main-content'),
                        splitPanel: iframeDoc.querySelector('.split-view-panel')
                    };

                    const componentStatus = {};
                    for (const [key, element] of Object.entries(components)) {
                        componentStatus[key] = {
                            exists: !!element,
                            className: element?.className || 'not found'
                        };
                    }

                    addResult('Component Rendering Status', componentStatus, 
                        componentStatus.splitView?.exists ? 'success' : 'error');

                    // Check React render root
                    const reactRoot = iframeDoc.querySelector('#root');
                    addResult('React Root', {
                        exists: !!reactRoot,
                        hasChildren: reactRoot?.children.length > 0,
                        innerHTML: reactRoot?.innerHTML?.substring(0, 200) + '...'
                    });

                } catch (error) {
                    addResult('Error accessing iframe', error.message, 'error');
                }
            };
            
            resultsDiv.appendChild(iframe);
        }

        async function testSplitViewInteraction() {
            clearResults();
            addResult('Split View Interaction Test', 'Please navigate to the Collection Opportunities page and click on any row to test the split view panel.', 'info');
            
            // Open in new window
            window.open(`${baseUrl}/collection-opportunities`, '_blank');
        }

        async function checkForModals() {
            clearResults();
            
            const modalCheck = `
// Run this in the console on the Collection Opportunities page:
const check = {
    hasOverlay: !!document.querySelector('.bp5-overlay'),
    hasDialog: !!document.querySelector('.bp5-dialog'),
    hasModalBackdrop: !!document.querySelector('.bp5-overlay-backdrop'),
    hasSplitViewPanel: !!document.querySelector('.split-view-panel'),
    hasSplitViewContainer: !!document.querySelector('.collection-opportunities-split-view'),
    activeComponent: document.querySelector('[class*="collection-opportunities"]')?.className || 'none'
};
console.table(check);
`;
            
            addResult('Modal Check Script', modalCheck, 'info');
        }

        // Initial check
        checkFeatureFlags();
    </script>
</body>
</html>